<h1><%= params[:id] %></h1>
<a href="/">Home</a>
<% form_tag "/sections/#{params[:id]}/search", :method => 'get' do %>
  <p>
    <%= text_field_tag :q, params[:q] %>
    <%= submit_tag "Search", :name => nil %>
  </p>
<% end %>
<div id="loading" style="position: absolute; width: 100%; height: 100%; background: rgba(255,255,255,.5); text-align: center;"><div style="width: 300px; margin: 0 auto; font-size: 3em; margin-top: 5em;">Loading pics</div></div>
<div id="content">
</div>
<script>
var currentAjaxRequest = null;
jQuery.ajaxQueue = function(ajaxOptions)
{
    var success = ajaxOptions.success;
    var error = ajaxOptions.error;
    var complete = ajaxOptions.complete;

    ajaxOptions.success = function()
    {
        if (success) { try { success.apply(this, arguments); } catch (e) { } }
    };
    ajaxOptions.error = function()
    {
        if (error) { try { error.apply(this, arguments); } catch (e) { } }
    };
    ajaxOptions.complete = function()
    {
        if (complete) { try { complete.apply(this, arguments); } catch (e) { } }
        currentAjaxRequest = null;
        $(window).dequeue("ajax");
    };
    $(window).queue("ajax", function()
    {
        currentAjaxRequest = jQuery.ajax(ajaxOptions);
    });
    if (currentAjaxRequest === null) { $(window).dequeue("ajax"); }
};

$(document).ready(function () {
	$('#loading').hide().ajaxStart(function() {
		$(this).show();
	}).ajaxStop(function() {
		$(this).hide();
	});
	$(<%= @items.to_json.html_safe %>).each(function(i,e){
		$.ajax({
		      url: '/items/'+e['id']+'.json?link='+e['link'],
		      type: "GET",
		      async:true,
		      success: function(data){
		         $('#content').prepend('<a href="'+data.href+'"><img src='+data.img+' width="100"></a>');
		      }
		});
		// $.ajaxQueue('/items/'+e+'.json', function(data) {
		//   $('#content').prepend('<a href="'+data.href+'"><img src='+data.img+' width="100"></a>');
		// });
	});
});
</script>